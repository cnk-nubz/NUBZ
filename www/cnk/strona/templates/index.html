<!DOCTYPE html>
<html>
{% load compress %}
{% load staticfiles %}
<head>
  <meta charset="utf-8">
  <link rel="icon" href="{%static "favicon.ico" %}">
  <link href="{% static "css/base.css" %}" rel="stylesheet">
  <title>Tajny Projekt NUBZ</title>
</head>

<body>
<script src="{% static "js/d3.v3.min.js" %}"></script>
{% compress js %}
<script type="text/coffeescript">

  margin = {top: -5, right: -5, bottom: -5, left: -5}
  width = 900 - margin.left - margin.right
  height = 900 - margin.top - margin.bottom

  dottype = (d) ->
    d.x = +d.x
    d.y = +d.y
    return d

  zoomed = ->
    container.attr("transform", "translate(" + d3.event.translate + ")scale(" + d3.event.scale + ")")

  dragstarted = (d) ->
    d3.event.sourceEvent.stopPropagation()
    d3.select(this).classed("dragging", true)

  dragged = (d) ->
    d3.select(this).attr("cx", d.x = d3.event.x).attr("cy", d.y = d3.event.y)

  dragended = (d) ->
    d3.select(this).classed("dragging", false)


  zoom = d3.behavior.zoom()
    .scaleExtent([1, 10])
    .on("zoom", zoomed)

  drag = d3.behavior.drag()
    .origin((d) -> d)
    .on("dragstart", dragstarted)
    .on("drag", dragged)
    .on("dragend", dragended)

  svg = d3.select("body").append("svg")
    .attr("width", width + margin.left + margin.right)
    .attr("height", height + margin.top + margin.bottom)
  .append("g")
    .attr("transform", "translate(" + margin.left + "," + margin.right + ")")
    .call(zoom)

  svg.append("defs")
  	.append("pattern")
    .attr({
      "id": "bg",
      "patternUnits": "userSpaceOnUse",
      "width": width,
      "height": height,
      "preserveAspectRatio": "xMinYMin meet",
      })
  	.append("image")
  	.attr({
  		"width": width,
  		"height": height,
  		"x": "0",
  		"y": "0",
  		"xlink:href": "{% static "floorplan.jpg" %}",
  	})


  container = svg.append("g")

  container.append("rect")
    .attr({
      "width": width,
      "height": height,
      })
    .style("fill", "url(#bg)")

  #EXAMPLE STRUCTURES TO DRAG
  datum = [
      {x: 100, y: 100, r: 23},
      {x: 200, y: 200, r: 10},
      {x: 300, y: 300, r: 15},
    ];
  dot = container.append("g")
      .attr("class", "dot")
    .selectAll("circle")
      .data(datum)
    .enter().append("circle")
      .attr("r", (d) -> d.r)
      .attr("cx", (d) -> d.x)
      .attr("cy", (d) -> d.y)
      .call(drag);

</script>
{% endcompress %}
</body>
